<!DOCTYPE html>
<html lang="en">
  <head>
    <title>World</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/dat.gui.css">
    <style>
      * { font-size: 10px; }
      body { background-color: #000; }
      #info {
        color: #fff;
        position: absolute;
        top: 10px;
        width: 100%;
        text-align: center;
        display:block;
      }
      #info a {
        color: #046;
        font-weight: bold;
      }
      .info-panel {
        width: 15rem;
        background-color: rgba(255, 255, 255, 0.5);
        height: auto;
        padding: 1rem 0.5rem;
        margin: 0;
        position: absolute;
      }
      .side {
        top: 4vh;
        height: 96vh;
        color: #eee;
        width: 20rem;
      }
      .side .container h5 {
        font-variant: small-caps;
        font-size: 1rem;
        text-shadow: 1px 1px 0 #000;
        border-bottom: 2px solid #000;
        padding-bottom: 0.33rem;
      }
      .side table { border: 1px dotted #000; }
      .side table th {
        border-top: none;
        border-bottom: 1px solid #000;
        padding: 0.33rem;
        background: rgba(0, 0, 0, 0.33);
      }
      .side table td { border-top: 1px dotted #000; }
      .side-left {
        float: left;
        left: 0;
        background: linear-gradient(to right, rgba(71, 127, 56, 0.8) 0%, rgba(0, 0, 0, 0) 100%);
      }
      .side-right {
        float: right;
        right: 0;
        background: linear-gradient(to left, rgba(71, 127, 56, 0.8) 0%, rgba(0, 0, 0, 0) 100%);
      }
      canvas {
        width: 100vw;
        height: 100vh;
        padding: 0;
        margin: 0;
      }
      header .navbar { padding: 0 1rem; }
      header .navbar h5 { color: #eee; }
      .hide { display: none; }

      .container {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
      }

      #objttip {
        top: 10vh;
        left: 10vw;
      }

      .w90 { width: 90%; }
      .w100 { width: 100%; }
      .mw90 { max-width: 90%; }
      .w-overflow { overflow: auto; }

      .console {
        background: #000;
        color: #CCC;
        font-family: Consolas, fixed;
        font-size: 8px;
        border-color: #888;
      }
      .console:focus { color: #FFF; }

      #graph { background: rgba(255, 255, 255, 0.5); }
    </style>
  </head>
  <body>
    <header>
      <nav class="navbar navbar-dark bg-dark">
        <span class="navbar-text">
          <h5>
            <strong>DaVE</strong> &nbsp; <small>Datacenter Visualization Environment</small>
          </h5>
        </span>
        <span class="navbar-text pull-right">
          <span class="info-user pl-0 pr-2">
            <span class="js-username pr-2"><em>Logged out</em></span>
          </span>
          <span class="info-time px-2">
            <span class="js-time">&middot;</span>
          </span>
          <span class="info-actions pl-2 pr-0">
            <button class="btn btn-outline-danger btn-sm mr-1 js-btn-logout hide" type="button">Log out</button>
            <button class="btn btn-outline-success btn-sm mr-1 js-btn-login" type="button">Log in</button>
            <button class="btn btn-outline-primary btn-sm mr-0 js-btn-stats" type="button">Stats</button>
          </span>
        </span>
      </nav>
    </header>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <script src="./js/three.js"></script>
    <script src="./js/controls/OrbitControls.js"></script>
    <script src="./js/objects/Reflector.js"></script>
    <script src="./js/loaders/MTLLoader.js"></script>
    <script src="./js/loaders/OBJLoader.js"></script>
    <script src="./js/WebGL.js"></script>
    <script src="./js/stats.js"></script>
    <script src="./js/libs/dat.gui.min.js"></script>
    <script src="./js/moment.min.js"></script>
    <script src="./js/Chart.min.js"></script>
    <script src="./js/chartjs-plugin-streaming.min.js"></script>

    <script>
      if (WEBGL.isWebGLAvailable() === false) {
        document.body.appendChild(WEBGL.getWebGLErrorMessage());
      }

      var scene, camera, renderer, exporter, mesh, groundMirror, grid, mrrFadeout, spotLight;
      var sqSize = 100
      var globalObjects = []
      var noClickObjects = ['Ground', 'Grid', 'FadeoutMrr', 'GndMirror', 'GndMrr']
      var posMap = []
      var posX0 = -10
      var posZ0 = -10
      var cPosX = -10
      var cPosZ = -10
      var maxX = 8
      var maxZ = 8
      var stepX = 1
      var stepZ = 2
      var count = 0

      var cT, cTi

      var dirLights = []
      var hemiLights = []
      var ghLights = []

      var raycaster = new THREE.Raycaster();
      var mouse = new THREE.Vector2();

      function dec2hex(i) {
        var result = "0x000000";
        if (i >= 0 && i <= 15) { result = "0x00000" + i.toString(16); }
        else if (i >= 16 && i <= 255) { result = "0x0000" + i.toString(16); }
        else if (i >= 256 && i <= 4095) { result = "0x000" + i.toString(16); }
        else if (i >= 4096 && i <= 65535) { result = "0x00" + i.toString(16); }
        else if (i >= 65535 && i <= 1048575) { result = "0x0" + i.toString(16); }
        else if (i >= 1048575 ) { result = '0x' + i.toString(16); }
        if (result.length == 8) { return result; }
      }
      var deg2rad = function(degree) { return degree * (Math.PI / 180); }

      var modelsMap = {
        '1stbuilding':   { scale: 15, oX: 20, oZ: 20, count: 0, model: null, lX: 20, lY: 20, lZ: 20 },
        '2squerbuild':   { scale: 15, oX: 65, oZ: 50, count: 0, model: null },
        '3base':         { scale: 15, oX: 45, oZ: 45, count: 0, model: null },
        'bigbmw':        { scale: 1,  oX: 50, oZ: 50, count: 0, model: null },
        'bmw':           { scale: 15, oX: 50, oZ: 75, count: 0, model: null },
        'bmwbigf':       { scale: 1,  oX: 50, oZ: 50, count: 0, model: null },
        'buildings1':    { scale: 15, oX: 55, oZ: 75, count: 0, model: null },
        'lastnode':      { scale: 15, oX: 50, oZ: 50, count: 0, model: null },
        'lighttower':    { scale: 1,  oX: 50, oZ: 50, count: 0, model: null },
        'merscobj':      { scale: 15, oX: 40, oZ: 50, count: 0, model: null },
        'moderntower':   { scale: 15, oX: 80, oZ: 50, count: 0, model: null },
        'prison':        { scale: 1,  oX: 50, oZ: 50, count: 0, model: null },
        'SciFi_3':       { scale: 15, oX: 15, oZ: 90, count: 0, model: null },
        'scifitower':    { scale: 15, oX: 50, oZ: 80, count: 0, model: null },
        'silos':         { scale: 1,  oX: 50, oZ: 50, count: 0, model: null },
        'simple':        { scale: 15, oX: 50, oZ: 50, count: 0, model: null },
        'simlebuilding': { scale: 15, oX: 80, oZ: 20, count: 0, model: null },
        'tallbuilding':  { scale: 15, oX: 20, oZ: 20, count: 0, model: null },
        'tallbuildingb': { scale: 1,  oX: 50, oZ: 50, count: 0, model: null },
        'tallfix':       { scale: 1,  oX: 50, oZ: 50, count: 0, model: null },
        'torus':         { scale: 1,  oX: 50, oZ: 50, count: 0, model: null }
      }
      var logoMap = ["Apache_kafka", "centos", "clickhouse", "elastic", "flink", "git", "Prometheus", "spark", "ubuntu", "zepelin", "Zoo"]

      var userAdapter = {
        doLogin: function() {
          var username = prompt('Enter your username:')
          this.data.name = username.trim()
          this.data.active = true
          localStorage.setItem('user', JSON.stringify(this.data))
          this.updateUi()
        },
        doLogout: function() {
          this.data.name = null
          this.data.active = false
          localStorage.removeItem('user')
          this.updateUi()
        },
        updateUi: function() {
          if (this.data.active) {
            $('.js-username').html('@' + this.data.name)
            $('.js-btn-login').addClass('hide')
            $('.js-btn-logout').removeClass('hide')
          } else {
            $('.js-username').html('<em>Logged out</em>')
            $('.js-btn-login').removeClass('hide')
            $('.js-btn-logout').addClass('hide')
          }
        },
        init: function() {
          if (localStorage.getItem('user') !== null) {
            var tmpUser = JSON.parse(localStorage.getItem('user'))
            this.data.name = tmpUser.name
            this.data.active = true
          }
          this.updateUi()
        },
        data: {
          name: null,
          active: false
        }
      }

      var multiPlace = false

      $(function() {
        Object.getOwnPropertyNames(modelsMap).forEach(function(model) {
          $('#typeSelect').append('<option value="' + model + '">' + model + '</option>')
        })

        $('#addBtn').click(function() {
          var mdl = $('#typeSelect').val()
          if (cPosX <= maxX) {
            cPosX += count === 0? 0 : stepX
          } else {
            cPosX = posX0
            cPosZ += stepZ
          }
          var sqOffset = { x: cPosX, z: cPosZ }
          addModel(scene, mdl, sqOffset)

          if (modelsMap[mdl].count) {
            $('.js-object-list tbody').find('.js-count-' + mdl).find('.js-num').html(modelsMap[mdl].count)
          } else {
            $('.js-object-list tbody').append('<tr class="js-count-' + mdl + '"><td>' + mdl + '</td><td class="js-num">1</td></tr>')
          }
          count++
        })
        $('#addBtnMulti').click(function() {
          multiPlace = true
          var count = prompt('Number: ')
          for (var i = 0; i < count; i++) {
            $('#addBtn').trigger('click')
          }
          multiPlace = false
        })

        $('.js-btn-stats').click(function() {
          $(stats.domElement).toggleClass('hide')
        })

        userAdapter.init()
        $('.js-btn-login').click(function() {
          userAdapter.doLogin()
        })
        $('.js-btn-logout').click(function() {
          userAdapter.doLogout()
        })

        cTi = setInterval(function() {
          cT = new Date()
          $('.js-time').html(cT.toLocaleTimeString('hr'))
        }, 500)

        $('.dg.ac').css('top', '3rem').css('right', '30rem')

        $('#console').text('neven@Neven-E580:~/Code/DT-demo (master)\r\n[' + (new Date()).toLocaleTimeString('hr') + '] $ ')

        var ctx = document.getElementById('graph').getContext('2d');
        var chart = new Chart(ctx, {
          type: 'line',
          data: {
            datasets: [{
              data: [],
              label: 'Load',
              borderColor: 'rgb(239, 0, 0)',
              backgroundColor: 'rgba(239, 0, 0, 0.5)',
            }]
          },
          options: {
            scales: {
              xAxes: [{
                type: 'realtime',
                realtime: {
                  delay: 2000,
                  onRefresh: function(chart) {
                    chart.data.datasets.forEach(function(dataset) {
                      dataset.data.push({
                        x: Date.now(),
                        y: Math.random()
                      });
                    });
                  }
                }
              }]
            }
          }
        });

      })

      var stats = new Stats()
      $(stats.domElement).css('top', '3rem').css('right', 0).css('left', '')
      stats.showPanel(0)
      document.body.appendChild(stats.dom)
      $(stats.domElement).addClass('hide')

      function createObject(scene, objName, params, callback) {
        var loader = new THREE.MTLLoader()

        var objPath = './res/obj/'
        loader.load(
          objPath + objName + '.mtl',
          function (materials) {
            materials.preload();
            new THREE.OBJLoader()
              .setMaterials(materials).load(objPath + objName + '.obj', function (object) {
                callback(object, params)
              },
              function (xhr) {
                // do nothing
              },
              function (err) {
                console.error('An error happened while loading MTL object.', err);
              }
            )
          }
        )
      }

      function onDocumentMouseUp(event) {
        if (event.button === 0) {
          var lMap = event.path.filter(function(x) { return $(x)[0].id === 'objttip' })
          if (lMap.length > 0) {
            event.preventDefault()
          } else {
            mouse.x = (event.clientX / renderer.domElement.clientWidth) * 2 - 1
            mouse.y = -(event.clientY / renderer.domElement.clientHeight) * 2 + 1
            raycaster.setFromCamera(mouse, camera)

            var intersects = raycaster.intersectObjects(scene.children, true)
            if (intersects.length >= 1) {
              spotLight.position.set(camera.position)

              if (noClickObjects.indexOf(intersects[0].object.name) === -1) {
                console.log('Clicked object type: ' + intersects[0].object.geometry.name, intersects[0])
                $('#objttip').css('left', event.x + 50).css('top', event.y).removeClass('hide')
                $('.obj-panel').removeClass('hide')
                $('.obj-panel .obj-dist').text(intersects[0].distance)
                $('.obj-panel .obj-type').text(intersects[0].object.parent.userData.type)
                $('.obj-panel .obj-uuid').text(intersects[0].object.uuid)
                spotLight.target = intersects[0].object.parent
              } else {
                $('.obj-panel').addClass('hide')
              }
            } else {
              $('#objttip').addClass('hide')
            }
          }
        }
      }
      document.addEventListener('mouseup', onDocumentMouseUp, false)

      function onDocumentMouseMove(evt) {
        if (evt.buttons === 1 && evt.button === 0) { // drag!
          var lMap = evt.path.filter(function(x) { return $(x)[0].id === 'objttip' })
          if (lMap.length > 0) {
            $('#objttip').css('left', evt.x - 15).css('top', evt.y - 15)
            evt.preventDefault()
          }
        }
      }
      document.addEventListener('mousemove', onDocumentMouseMove, false)

      function rnd(min, max) {
        return Math.floor(Math.random() * max) + min
      }

      function setupWorld() {
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 8000);
        camera.position.set(1000, 1000, 1000);
        camera.translateX(500)
        camera.translateZ(1000)

        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);
        scene.fog = new THREE.Fog(0x000000, 1000, 8000);

        // ground
        ground = new THREE.Mesh(new THREE.PlaneBufferGeometry(2000, 2000), new THREE.MeshPhongMaterial({ color: 0x333333, depthWrite: true }));
        ground.name = 'Ground'
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = false;
        ground.opacity = 0.8
        scene.add(ground);

        var geometry = new THREE.PlaneBufferGeometry(2000, 2000);
        geometry.name = 'GndMirror'
        groundMirror = new THREE.Reflector(geometry, {
          clipBias: 0.8,
          textureWidth: window.innerWidth * window.devicePixelRatio,
          textureHeight: window.innerHeight * window.devicePixelRatio,
          color: 0x848484,
          recursion: 1
        });
        groundMirror.name = 'GndMrr'
        groundMirror.position.y = 0.5;
        groundMirror.rotateX(-Math.PI / 2);
        scene.add(groundMirror);

        mrrFadeout = new THREE.Mesh(new THREE.PlaneBufferGeometry(2000, 2000), new THREE.MeshLambertMaterial({ color: 0x000300, opacity : 0.85 , transparent: true }))
        mrrFadeout.name = 'FadeoutMrr'
        mrrFadeout.position.y = 0.85
        mrrFadeout.rotateX(-Math.PI / 2)
        scene.add(mrrFadeout)

        grid = new THREE.GridHelper(2000, 20, 0x3bff7f, 0x3bff7f);
        grid.name = 'Grid'
        grid.material.opacity = 1;
        grid.material.transparent = true;
        scene.add(grid);

        // hemiLight - main, central
        hemiLights.push(addHemiLight(scene, {
          color: 0xffffff,
          groundColor: 0xaaaaaa,
          intensity: 2,
          coords: { x: 0, y: 1000, z: 0 }
        }))
        // hemiLight - bordering
        hemiLights.push(addHemiLight(scene, {
          color: 0xffffff,
          groundColor: 0xaaaaaa,
          intensity: 2,
          coords: { x: 500, y: 1000, z: 500 }
        }))
        hemiLights.push(addHemiLight(scene, {
          color: 0xffffff,
          groundColor: 0xaaaaaa,
          intensity: 2,
          coords: { x: 500, y: 1000, z: -500 }
        }))
        hemiLights.push(addHemiLight(scene, {
          color: 0xffffff,
          groundColor: 0xaaaaaa,
          intensity: 2,
          coords: { x: -500, y: 1000, z: -500 }
        }))
        hemiLights.push(addHemiLight(scene, {
          color: 0xffffff,
          groundColor: 0xaaaaaa,
          intensity: 2,
          coords: { x: -500, y: 1000, z: 500 }
        }))
      }

      function addHemiLight(scene, params) {
        var hemiLight = new THREE.HemisphereLight(params.color, params.groundColor, params.intensity)
        var hlHelper = new THREE.HemisphereLightHelper(hemiLight, 50, 0xffff00)
        hemiLight.position.set(params.coords.x, params.coords.y, params.coords.z);
        scene.add(hemiLight);
        scene.add(hlHelper);

        return hemiLight
      }
      function addDirLight(scene, params) {
        var dirLight = new THREE.DirectionalLight(params.color, params.intensity)
        dirLight.position.set(params.coords.x, params.coords.y, params.coords.z)
        dirLight.castShadow = false
        dirLight.target.position.set(params.coords.x, 0, params.coords.z)
        scene.add(dirLight)
        scene.add(dirLight.target)

        var dlHelper = new THREE.DirectionalLightHelper(dirLight, 10, 0x0088ff)
        scene.add(dlHelper)

        return dirLight
      }

      function addSpotLight(scene, params) {
        var spotLight = new THREE.SpotLight(params.color, params.intensity)
        spotLight.position.set(params.coords.x, params.coords.y, params.coords.z)
        spotLight.castShadow = false
        spotLight.angle = Math.PI / 4;
        spotLight.penumbra = 0.05;
        spotLight.decay = 2;
        spotLight.distance = 200;
        scene.add(spotLight)

        var slHelper = new THREE.SpotLightHelper(spotLight, 10, 0x0000ff)
        scene.add(slHelper)

        return spotLight
      }

      function addModel(scene, model, sqOffset) {
        if (modelsMap[model].model) {
          var mdl = modelsMap[model].model.clone()
          var oX = 0
          var oZ = 0
          if (sqOffset && typeof sqOffset === 'object') {
            oX = sqSize * sqOffset.x
            oZ = sqSize * sqOffset.z
          }
          mdl.position.x = oX + modelsMap[model].oX
          mdl.position.z = oZ + modelsMap[model].oZ
          modelsMap[model].count++
          scene.add(mdl)
        } else {
          createObject(scene, model, sqOffset, function(obj, sqOffset) {
            obj.scale.set(modelsMap[model].scale, modelsMap[model].scale, modelsMap[model].scale)
            var oX = 0
            var oZ = 0
            if (sqOffset && typeof sqOffset === 'object') {
              oX = sqSize * sqOffset.x
              oZ = sqSize * sqOffset.z
            }
            obj.position.x = oX + modelsMap[model].oX
            obj.position.z = oZ + modelsMap[model].oZ
            obj.userData.type = model
            modelsMap[model].count = 1
            modelsMap[model].model = obj
            scene.add(obj);
          })
        }
      }

      function initLogos() {
        logoMap.forEach(function(logo) {
          if (cPosX <= maxX) {
            cPosX += count === 0? 0 : stepX
          } else {
            cPosX = posX0
            cPosZ += stepZ
          }
          var sqOffset = { x: cPosX, z: cPosZ }
          createObject(scene, 'logos/' + logo, sqOffset, function(obj, sqOffset) {
            console.log('Loading: ', logo)
            var scale = 5
            obj.scale.set(scale, scale, scale)
            var oX = 0
            var oZ = 0
            if (sqOffset && typeof sqOffset === 'object') {
              oX = sqSize * sqOffset.x
              oZ = sqSize * sqOffset.z
            }
            obj.position.x = oX + 50
            obj.position.z = oZ + 50
            obj.userData.type = logo
            scene.add(obj);
          })
          count++
        })
      }

      function init() {
        setupWorld()
        initLogos()

        /*
        dirLights[0] = addDirLight(scene, {
          color: 0xffffff,
          intensity: 3,
          coords: { x: -200, y: 1000, z: 200 }
        })
        dirLights[1] = addDirLight(scene, {
          color: 0xffffff,
          intensity: 3,
          coords: { x: 800, y: 1000, z: 600 }
        })
        dirLights[2] = addDirLight(scene, {
          color: 0xffffff,
          intensity: 3,
          coords: { x: -450, y: 1000, z: -450 }
        })

        dirLights[0].position.set(500, 1000, 500)
        dirLights[1].position.set(0, 1000, 500)
        dirLights[2].position.set(-500, 1000, -500)
        */

        spotLight = addSpotLight(scene, {
          color: 0xffffff,
          intensity: 3,
          coords: { x: -450, y: 1000, z: -450 }
        })

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight - 34);
        renderer.shadowMap.enabled = false;
        document.body.appendChild(renderer.domElement);

        var controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.target.set(100, 100, 100);
        controls.maxPolarAngle = Math.PI / 2
        controls.update();

        window.addEventListener('resize', onWindowResize, false);
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }
      function animate() {
        stats.begin()
        stats.end()
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }

      init();
      animate();

      // DAT.GUI Related Stuff
      var gui = new dat.GUI();

      var gOptions = {
        grid: {
          visible: true,
          color: 0xffffff
        },
        ground: {
          visible: true,
          color: 0x000300,
          reflectivity: 0.85
        },
        lights: {
          hemi: []
        },
        sidebars: {
          width: 20,
          startColor: 0x477f38,
          endColor: 0x000000,
          startOpacity: 80,
          endOpacity: 0,
        },
        mkGrad: function() {
          var sc = dec2hex(this.sidebars.startColor).substr(2)
          var scR = parseInt(sc.substr(0, 2), 16)
          var scG = parseInt(sc.substr(2, 2), 16)
          var scB = parseInt(sc.substr(4, 2), 16)
          var se = dec2hex(this.sidebars.endColor).substr(2)
          var seR = parseInt(se.substr(0, 2), 16)
          var seG = parseInt(se.substr(2, 2), 16)
          var seB = parseInt(se.substr(4, 2), 16)
          var oS = this.sidebars.startOpacity / 100
          var oE = this.sidebars.endOpacity / 100
          $('.side-left').css('background', '-webkit-gradient(linear, left center, right center, from(rgba(' + scR + ', ' + scG + ', ' + scB + ', ' + oS + ')), to(rgba(' + seR + ', ' + seG + ', ' + seB + ', ' + oE + ')))')
          $('.side-right').css('background', '-webkit-gradient(linear, right center, left center, from(rgba(' + scR + ', ' + scG + ', ' + scB + ', ' + oS + ')), to(rgba(' + seR + ', ' + seG + ', ' + seB + ', ' + oE + ')))')
        },
      };
      var cGl = {}
      for (var ghc = 0; ghc < hemiLights.length; ghc++) {
        gOptions.lights.hemi[ghc] = {
          index: ghc,
          visible: true,
          color: 0xffffff,
          intensity: 2,
          positionX: 0,
          positionY: 1000,
          positionZ: 0
        }
        cGl[ghc] = ghc
      }

      var gCamera = gui.addFolder('Camera');
      gCamera.add(camera.position, 'x', -5000, 5000).name('X').listen()
      gCamera.add(camera.position, 'y', -5000, 5000).name('Y').listen()
      gCamera.add(camera.position, 'z', -5000, 5000).name('Z').listen()

      var gGrid = gui.addFolder('Grid');
      gGrid.add(grid, 'visible').name('Visible').listen()
      gGrid.addColor(gOptions.grid, 'color').name('Color').onChange(function() {
        grid.material.color.setHex(dec2hex(gOptions.grid.color))
      })

      var gGround = gui.addFolder('Ground');
      gGround.add(mrrFadeout, 'visible').name('Visible').listen()
      gGround.addColor(gOptions.ground, 'color').name('Color').onChange(function() {
        mrrFadeout.material.color.setHex(dec2hex(gOptions.ground.color))
      })
      gGround.add(mrrFadeout.material, 'opacity', 0.25, 1).name('Matte').listen()

      for (var ghc = 0; ghc < hemiLights.length; ghc++) {
        ghLights[ghc] = gui.addFolder('HemisphereLight #' + (ghc + 1))
        ghLights[ghc].add(gOptions.lights.hemi[ghc], 'visible').name('Visibility').onChange(function() {
          hemiLights[this.object.index].visible = gOptions.lights.hemi[this.object.index].visible;
        });
        ghLights[ghc].addColor(gOptions.lights.hemi[ghc], 'color').name('Color').onChange(function() {
          hemiLights[this.object.index].color.setHex(dec2hex(gOptions.lights.hemi[this.object.index].color));
        })
        ghLights[ghc].add(gOptions.lights.hemi[ghc], 'intensity', 1, 20).name('Intensity').onChange(function() {
          hemiLights[this.object.index].intensity = gOptions.lights.hemi[this.object.index].intensity;
        });
        ghLights[ghc].add(gOptions.lights.hemi[ghc], 'positionX', -1000, 1000).name('Position X').onChange(function() {
          hemiLights[this.object.index].position.x = gOptions.lights.hemi[this.object.index].positionX;
        });
        ghLights[ghc].add(gOptions.lights.hemi[ghc], 'positionY', -1000, 1000).name('Position Y').onChange(function() {
          hemiLights[this.object.index].position.y = gOptions.lights.hemi[this.object.index].positionY;
        });
        ghLights[ghc].add(gOptions.lights.hemi[ghc], 'positionZ', -1000, 1000).name('Position Z').onChange(function() {
          hemiLights[this.object.index].position.z = gOptions.lights.hemi[this.object.index].positionZ;
        });
      }

      var gSbars = gui.addFolder('Sidebars')
      gSbars.add(gOptions.sidebars, 'width', 10, 30).onChange(function() {
        $('.side').css('width', gOptions.sidebars.width + 'rem')
      })
      gSbars.addColor(gOptions.sidebars, 'startColor').onChange(function() {
        gOptions.mkGrad()
      })
      gSbars.add(gOptions.sidebars, 'startOpacity', 0, 100).onChange(function() {
        gOptions.mkGrad()
      })
      gSbars.addColor(gOptions.sidebars, 'endColor').onChange(function() {
        gOptions.mkGrad()
      })
      gSbars.add(gOptions.sidebars, 'endOpacity', 0, 100).onChange(function() {
        gOptions.mkGrad()
      })

    </script>

    <div class="holder side side-left info-panel">
      <div class="container type-form mb-4">
        <h5>New object</h5>
        <form>
          <div class="form-group">
            <label for="typeSelect">Model type</label>
            <select class="form-control" id="typeSelect">
            </select>
          </div>
          <button id="addBtn" type="button" class="btn btn-primary">Add</button>
          <button id="addBtnMulti" type="button" class="btn btn-outline-light">Add multiple</button>
        </form>
      </div>
      <div class="container type-table my-4">
        <h5>Objects count</h5>
        <table class="table mw90 w90 w-overflow js-object-list">
          <thead>
            <tr>
              <th>Object</th>
              <th>Count</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>

    <div class="holder side side-right info-panel obj-panel">
      <div class="container type-list mb-4">
        <h5>Object info</h5>
        <dl class="card-text">
          <dt>Type</dt>
          <dd class="obj-type">&middot;</dd>
          <dt>UUID</dt>
          <dd class="obj-uuid">&middot;</dd>
          <dt>Distance</dt>
          <dd class="obj-dist">&middot;</dd>
        </dl>
      </div>
      <div class="container type-console my-4">
        <h5>Console</h5>
        <textarea name="console" id="console" cols="40" rows="10" class="console w100 w-overflow"></textarea>
      </div>
      <div class="container type-graph my-4">
        <h5>Graph</h5>
        <canvas id="graph"></canvas>
      </div>
    </div>

    <aside id="objttip" class="info-panel ttp-panel hide">
      <div class="container">
        Lorem ipsum dolor sit amet, nunc integer.
      </div>
    </aside>

  </body>
</html>
